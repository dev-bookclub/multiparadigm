name: Notify Discord on PR, Discussion

on:
  discussion:
    types: [created]
  discussion_comment:
    types: [created]
  pull_request:
    types: [opened]
  pull_request_review:
    types: [submitted]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          set -e

          EVENT="${{ github.event_name }}"
          echo "Triggered by event: $EVENT"

          TYPE=""
          TITLE=""
          URL=""
          AUTHOR=""
          COMMENT=""
          STATE=""

          case "$EVENT" in
            "discussion")
              TYPE="Discussion"
              TITLE="${{ github.event.discussion.title }}"
              URL="${{ github.event.discussion.html_url }}"
              AUTHOR="${{ github.event.discussion.user.login }}"
              ;;

            "discussion_comment")
              TYPE="Discussion ëŒ“ê¸€"
              TITLE="${{ github.event.discussion.title }}"
              URL="${{ github.event.comment.html_url }}"
              AUTHOR="${{ github.event.comment.user.login }}"
              ;;

            "pull_request")
              TYPE="Pull Request"
              TITLE="${{ github.event.pull_request.title }}"
              URL="${{ github.event.pull_request.html_url }}"
              AUTHOR="${{ github.event.pull_request.user.login }}"
              ;;

            "pull_request_review")
              TYPE="PR ë¦¬ë·°"
              TITLE="${{ github.event.pull_request.title }}"
              URL="${{ github.event.review.html_url }}"
              AUTHOR="${{ github.event.review.user.login }}"
              ;;
          esac

          # ë©”ì‹œì§€ êµ¬ì„±
          if [ "$EVENT" = "discussion_comment" ] || [ "$EVENT" = "pull_request_review" ]; then
            # ëŒ“ê¸€ì´ë‚˜ ë¦¬ë·°ì¸ ê²½ìš°
            MESSAGE="{
              \"content\": \"$TYPEê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\\nì‘ì„±ì: $AUTHOR\\nëŒ€ìƒ: $TITLE\\në§í¬: $URL\"
            }"
          else
            # ì¼ë°˜ ì´ë²¤íŠ¸ (PR, Discussion ìƒì„±)
            MESSAGE="{
              \"content\": \"$TYPEê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\\nì‘ì„±ì: $AUTHOR\\nì œëª©: $TITLE\\në§í¬: $URL\"
            }"
          fi

          echo "ğŸ“¤ Sending to Discord..."
          curl -s -X POST "$DISCORD_WEBHOOK" \
            -H "Content-Type: application/json" \
            -d "$MESSAGE"
